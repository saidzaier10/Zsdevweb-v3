<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Devis {{ quote.quote_number }}</title>
    <style>
        @page {
            size: A4;
            margin: 2cm;
            @bottom-right {
                content: "Page " counter(page) " sur " counter(pages);
                font-size: 9pt;
                color: #6b7280;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 10pt;
            line-height: 1.6;
            color: #1f2937;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 3px solid #1a56db;
        }

        .company-name {
            font-size: 28pt;
            font-weight: bold;
            color: #1a56db;
            margin-bottom: 10px;
        }

        .company-info {
            font-size: 9pt;
            color: #6b7280;
            line-height: 1.4;
        }

        .title {
            font-size: 24pt;
            font-weight: bold;
            color: #1a56db;
            text-align: center;
            margin: 30px 0 20px;
        }

        .section-title {
            font-size: 14pt;
            font-weight: bold;
            color: #1a56db;
            margin-top: 25px;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #e5e7eb;
        }

        .info-grid {
            display: table;
            width: 100%;
            margin-bottom: 15px;
        }

        .info-row {
            display: table-row;
        }

        .info-label {
            display: table-cell;
            font-weight: bold;
            padding: 4px 15px 4px 0;
            width: 150px;
        }

        .info-value {
            display: table-cell;
            padding: 4px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        thead {
            background-color: #1a56db;
            color: white;
        }

        th {
            padding: 10px;
            text-align: left;
            font-weight: bold;
            font-size: 10pt;
        }

        td {
            padding: 8px 10px;
            border-bottom: 1px solid #e5e7eb;
        }

        tbody tr:hover {
            background-color: #f9fafb;
        }

        .text-right {
            text-align: right;
        }

        .text-center {
            text-align: center;
        }

        .totals {
            margin-top: 20px;
            float: right;
            width: 300px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .total-label {
            font-weight: normal;
        }

        .total-value {
            font-weight: bold;
            text-align: right;
        }

        .grand-total {
            font-size: 14pt;
            color: #1a56db;
            border-top: 3px solid #1a56db;
            border-bottom: 3px solid #1a56db;
            margin-top: 5px;
            padding: 10px 0 !important;
        }

        .payment-schedule {
            background-color: #f9fafb;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .payment-item {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            border-bottom: 1px solid #e5e7eb;
        }

        .terms {
            font-size: 9pt;
            color: #4b5563;
            line-height: 1.5;
            margin-top: 20px;
        }

        .signature-section {
            margin-top: 50px;
            display: table;
            width: 100%;
        }

        .signature-box {
            display: table-cell;
            width: 45%;
            text-align: center;
            vertical-align: top;
        }

        .signature-line {
            margin-top: 60px;
            border-top: 1px solid #000;
            padding-top: 5px;
            font-size: 9pt;
        }

        .footer {
            margin-top: 30px;
            text-align: center;
            font-size: 8pt;
            color: #6b7280;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            background-color: #dbeafe;
            color: #1e40af;
            border-radius: 4px;
            font-size: 8pt;
            margin-left: 5px;
        }

        .clearfix::after {
            content: "";
            display: table;
            clear: both;
        }
    </style>
</head>
<body>
    <!-- En-t√™te -->
    <div class="header">
        <div class="company-name">{{ company.name }}</div>
        <div class="company-info">
            {{ company.address|linebreaks }}<br>
            {{ company.email }} | {{ company.phone }}<br>
            SIRET: {{ company.siret }} | TVA: {{ company.tva_number }}
        </div>
    </div>

    <!-- Titre DEVIS -->
    <div class="title">DEVIS</div>

    <!-- Informations du devis -->
    <div class="info-grid">
        <div class="info-row">
            <div class="info-label">Num√©ro de devis:</div>
            <div class="info-value">{{ quote.quote_number }}</div>
        </div>
        <div class="info-row">
            <div class="info-label">Date d'√©mission:</div>
            <div class="info-value">{{ today|date:"d/m/Y" }}</div>
        </div>
        <div class="info-row">
            <div class="info-label">Validit√©:</div>
            <div class="info-value">Jusqu'au {{ quote.expires_at|date:"d/m/Y" }}</div>
        </div>
    </div>

    <!-- Informations client -->
    <div class="section-title">INFORMATIONS CLIENT</div>
    <div class="info-grid">
        <div class="info-row">
            <div class="info-label">Nom:</div>
            <div class="info-value">{{ quote.client_name }}</div>
        </div>
        <div class="info-row">
            <div class="info-label">Email:</div>
            <div class="info-value">{{ quote.client_email }}</div>
        </div>
        {% if quote.client_phone %}
        <div class="info-row">
            <div class="info-label">T√©l√©phone:</div>
            <div class="info-value">{{ quote.client_phone }}</div>
        </div>
        {% endif %}
        {% if quote.company_name %}
        <div class="info-row">
            <div class="info-label">Entreprise:</div>
            <div class="info-value">{{ quote.company_name }}</div>
        </div>
        {% endif %}
        {% if quote.client_address %}
        <div class="info-row">
            <div class="info-label">Adresse:</div>
            <div class="info-value">{{ quote.client_address }}</div>
        </div>
        {% endif %}
    </div>

    <!-- Description du projet -->
    <div class="section-title">DESCRIPTION DU PROJET</div>
    <p><strong>Type de projet:</strong> {{ quote.project_type.name }}</p>
    <p style="margin-top: 10px;">{{ quote.project_description }}</p>

    <!-- D√©tail du devis -->
    <div class="section-title">D√âTAIL DU DEVIS</div>
    <table>
        <thead>
            <tr>
                <th>D√©signation</th>
                <th class="text-center">Qt√©</th>
                <th class="text-right">Prix unitaire HT</th>
                <th class="text-right">Total HT</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>{{ quote.project_type.name }}</td>
                <td class="text-center">1</td>
                <td class="text-right">{{ quote.project_type.base_price }} ‚Ç¨</td>
                <td class="text-right">{{ quote.project_type.base_price }} ‚Ç¨</td>
            </tr>
            <tr>
                <td>Design {{ quote.design_option.name }}</td>
                <td class="text-center">1</td>
                <td class="text-right">{{ quote.design_option.price_supplement }} ‚Ç¨</td>
                <td class="text-right">{{ quote.design_option.price_supplement }} ‚Ç¨</td>
            </tr>
            <tr>
                <td>Complexit√© {{ quote.complexity_level.name }} (√ó{{ quote.complexity_level.price_multiplier }})</td>
                <td class="text-center">1</td>
                <td class="text-right">Multiplicateur</td>
                <td class="text-right">√ó{{ quote.complexity_level.price_multiplier }}</td>
            </tr>
            {% for option in quote.supplementary_options.all %}
            <tr>
                <td>
                    {{ option.name }}
                    <span class="badge">{{ option.get_billing_type_display }}</span>
                </td>
                <td class="text-center">1</td>
                <td class="text-right">{{ option.price }} ‚Ç¨</td>
                <td class="text-right">{{ option.price }} ‚Ç¨</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Remise si applicable -->
    {% if quote.discount_value > 0 %}
    <p style="margin: 15px 0;">
        <strong>Remise appliqu√©e:</strong>
        {% if quote.discount_type == 'percent' %}
            {{ quote.discount_value }}%
        {% else %}
            {{ quote.discount_value }} ‚Ç¨
        {% endif %}
        {% if quote.discount_reason %}
            ({{ quote.discount_reason }})
        {% endif %}
    </p>
    {% endif %}

    <!-- Totaux -->
    <div class="clearfix">
        <div class="totals">
            <div class="total-row">
                <div class="total-label">Sous-total HT</div>
                <div class="total-value">{{ quote.subtotal_ht }} ‚Ç¨</div>
            </div>
            {% if quote.discount_value > 0 %}
            <div class="total-row">
                <div class="total-label">Remise</div>
                <div class="total-value">- {{ quote.discount_amount }} ‚Ç¨</div>
            </div>
            <div class="total-row">
                <div class="total-label">Total apr√®s remise HT</div>
                <div class="total-value">{{ quote.subtotal_ht|add:"-"|add:quote.discount_amount }} ‚Ç¨</div>
            </div>
            {% endif %}
            <div class="total-row">
                <div class="total-label">TVA ({{ quote.tva_rate }}%)</div>
                <div class="total-value">{{ quote.tva_amount }} ‚Ç¨</div>
            </div>
            <div class="total-row grand-total">
                <div class="total-label">TOTAL TTC</div>
                <div class="total-value">{{ quote.total_ttc }} ‚Ç¨</div>
            </div>
        </div>
    </div>

    <div style="clear: both;"></div>

    <!-- Conditions de paiement -->
    <div class="section-title">CONDITIONS DE PAIEMENT</div>
    <p>Le paiement s'effectuera en <strong>3 fois</strong> selon l'√©ch√©ancier suivant :</p>
    <div class="payment-schedule">
        <div class="payment-item">
            <div>üîπ 30% √† la signature du devis</div>
            <div><strong>{{ quote.payment_first }} ‚Ç¨</strong></div>
        </div>
        <div class="payment-item">
            <div>üîπ 40% √† mi-parcours du projet</div>
            <div><strong>{{ quote.payment_second }} ‚Ç¨</strong></div>
        </div>
        <div class="payment-item">
            <div>üîπ 30% √† la livraison finale</div>
            <div><strong>{{ quote.payment_final }} ‚Ç¨</strong></div>
        </div>
    </div>

    <!-- Planning pr√©visionnel -->
    <div class="section-title">PLANNING PR√âVISIONNEL</div>
    <p><strong>Dur√©e estim√©e:</strong> {{ quote.estimated_duration_days }} jours ouvr√©s</p>
    {% if quote.estimated_start_date %}
    <p><strong>Date de d√©but estim√©e:</strong> {{ quote.estimated_start_date|date:"d/m/Y" }}</p>
    {% endif %}
    {% if quote.estimated_end_date %}
    <p><strong>Date de livraison estim√©e:</strong> {{ quote.estimated_end_date|date:"d/m/Y" }}</p>
    {% endif %}

    <!-- Conditions g√©n√©rales -->
    <div class="section-title">CONDITIONS G√âN√âRALES</div>
    <div class="terms">
        <p><strong>Validit√© du devis:</strong> Ce devis est valable 30 jours √† compter de sa date d'√©mission.</p>
        <p><strong>D√©lai de r√©alisation:</strong> Le d√©lai indiqu√© est une estimation et peut varier en fonction de la complexit√© du projet et de la r√©activit√© du client dans la fourniture des √©l√©ments n√©cessaires.</p>
        <p><strong>R√©visions:</strong> Deux r√©visions majeures sont incluses dans le prix. Toute r√©vision suppl√©mentaire sera factur√©e en suppl√©ment √† hauteur de 80‚Ç¨/heure.</p>
        <p><strong>Propri√©t√© intellectuelle:</strong> Les droits de propri√©t√© intellectuelle sont transf√©r√©s au client apr√®s paiement complet du projet.</p>
        <p><strong>R√©siliation:</strong> En cas d'annulation par le client, les montants d√©j√† vers√©s restent acquis √† titre d'indemnit√© pour les travaux d√©j√† effectu√©s.</p>
        <p><strong>Garantie:</strong> Une garantie de 3 mois contre les bugs est incluse apr√®s la livraison finale.</p>
    </div>

    <!-- Section signature -->
    <div class="signature-section">
        <div class="signature-box">
            <p><strong>Pour l'entreprise</strong></p>
            <p>{{ company.name }}</p>
            <div class="signature-line">Signature et cachet</div>
        </div>
        <div style="display: table-cell; width: 10%;"></div>
        <div class="signature-box">
            <p><strong>Bon pour accord, le client</strong></p>
            <p>&nbsp;</p>
            <div class="signature-line">Signature pr√©c√©d√©e de "Lu et approuv√©"</div>
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        {{ company.footer_text }}
    </div>
</body>
</html>
